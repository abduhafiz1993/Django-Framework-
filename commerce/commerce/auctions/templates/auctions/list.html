<!-- listing_detail.html -->

{% extends 'auctions/layout.html' %}

{% block body %}
  <h2>{{ listing.title }}</h2>
  <p>{{ listing.description }}</p>
  <p>Starting Bid: ${{ listing.starting_bid }}</p>
  <p>Current Price: ${{ listing.current_price }}</p>
  {% if listing.image %}
    <img src="{{ listing.image.url }}" alt="{{ listing.title }}">
  {% endif %}

  {% if user.is_authenticated %}
    <form method="post" action="{% url 'listing' pk=listing.pk %}">
      {% csrf_token %}
      <button type="submit" name="close_auction">Close Auction</button>
    </form>

    <form method="post" action="{% url 'listing' pk=listing.pk %}">
      {% csrf_token %}
      <button type="submit" name="watchlist_action">{% if watchlist_status %}Remove from Watchlist{% else %}Add to Watchlist{% endif %}</button>
    </form>

    <form method="post" action="{% url 'listing' pk=listing.pk %}">
      {% csrf_token %}
      {{ bid_form.as_p }}
      <button type="submit">Place Bid</button>
    </form>

    <h3>Comments</h3>
    {% for comment in comments %}
      <p>{{ comment.commenter.username }} said: {{ comment.text }}</p>
    {% endfor %}

    <form method="post" action="{% url 'listing' pk=listing.pk %}">
      {% csrf_token %}
      {{ comment_form.as_p }}
      <button type="submit">Add Comment</button>
    </form>
  {% endif %}

  {% if won_auction %}
    <p>Congratulations! You won this auction!</p>
  {% endif %}
{% endblock %}
